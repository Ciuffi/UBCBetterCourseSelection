<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UBC Course Scraper</title>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=sunburst"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
<script>
    function update() {
        lastScrape();
        scrapeStatus();
    }
    window.onload = update();
    function lastScrape() {
        $.get("/getLastScrapeTime", function (res) {
            $("#lastScrapeId").get(0).innerText = "Last Scrape: " + res;
        });
    }
    function scrapeStatus() {
        $.get("/scrapeStatus", function (res) {
            if (res){
                $("#scrapeStatus").get(0).innerText = "Scrape Status: Scraping..";
            }else{
                $("#scrapeStatus").get(0).innerText = "Scrape Status: Not Scraping";
            }
        })
    }
    function getDepartments() {
        $.get("/getDepartments", function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function getDepartmentByCode() {
        code = $('#search')[0].value;
        $.get("/getDepartmentByCode", {code: code}, function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function getCoursesByCode() {
        code = $('#search')[0].value;
        $.get("/getCoursesByCode", {code: code}, function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function getSectionsByCode() {
        code = $('#search')[0].value;
        $.get("/getSectionsByCode", {code: code}, function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function updateSectionInfo() {
        code = $('#search')[0].value;
        $.get("/sectionData", {code: code}, function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
</script>
<h1>UBC Course Scraper and Database Accessor (Alpha)</h1>
<h3>Scraper</h3>
<p id="lastScrapeId">Last Scrape: </p>
<p id="scrapeStatus">Scrape Status: </p>
<button onclick="update()">Update</button>
<button onclick="location.href='/Departments';">Table View</button>
<h4>Database Accessor</h4>
<label for="search">Code: </label>
<input id="search"/>
<br>
<br>
<button onclick="getDepartments()">Get All Departments</button>
<button onclick="getDepartmentByCode()">Get Department By Code</button>
<button onclick="getCoursesByCode()">Get Courses By Code</button>
<button onclick="getSectionsByCode()">Get Sections By Code</button>
<button onclick="updateSectionInfo()">Update section info</button>
<br>
<pre class="prettyprint lang-json" id="result"></pre>
<h4> API Access</h4>
<p>You use the information stored by this app in your own program through the API provided here.</p>
        <b>/getDepartments</b> List of all departments
        returns a list of all the departments as json objects that looks like this:
        <br>
<pre>
    {
        Name: String
        Code: String
        URL: String
        Faculty: String
    }
    </pre>
        <b>/getDepartmentByCode</b> List of courses by department code
        returns a department specified with a 'code' parameter in the post message:
<pre>
    {
        Name: String
        Code: String
        URL: String
        Faculty: String
    }
    </pre>
        <b>/getCoursesByCode</b> List of courses by department code
        returns a list of all the courses in a department specified with a 'code' parameter in the post message:
<pre>
    {
        Name: String
        Code: String
        URL: String
    }
    </pre>
        <b>/getSectionsByCode</b> List of sections by course code
        returns a list of all the sections ina course specified with a 'code' parameter in the post message:
<pre>
    {
        Code: String
        Teacher: String
        Building: String
        Room: String
        TotalSeatsRemaining: int
        CurrentlyRegistered: int
        GeneralSeatsRemaining: int
        RestrictedSeatsRemaining: int
    }
    </pre>
        <b>/getLastScrapeTime</b> Returns the last time the database was updated.
<br>
<br>
<br>
<a href="https://github.com/Ciuffi/UBCCourseScraper">Github</a>
</body>
</html>