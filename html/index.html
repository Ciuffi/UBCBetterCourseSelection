<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UBC Course Scraper</title>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=sunburst"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
<script>
    function update() {
        lastScrape();
        scrapeStatus();
    }
    window.onload = update();
    function lastScrape() {
        $.get("/getLastScrapeTime", function (res) {
            $("#lastScrapeId").get(0).innerText = "Last Scrape: " + res;
        });
    }
    function scrapeStatus() {
        $.get("/scrapeStatus", function (res) {
            if (res){
                $("#scrapeStatus").get(0).innerText = "Scrape Status: Scraping..";
            }else{
                $("#scrapeStatus").get(0).innerText = "Scrape Status: Not Scraping";
            }
        })
    }
    function getDepartments() {
        $.get("/getDepartments", function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function getDepartmentByCode() {
        code = $('#search')[0].value;
        $.get("/getDepartmentByCode", {code: code}, function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function getCoursesByCode() {
        code = $('#search')[0].value;
        $.get("/getCoursesByCode", {code: code}, function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function getSectionsByCode() {
        code = $('#search')[0].value;
        $.get("/getSectionsByCode", {code: code}, function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function updateSectionInfo() {
        code = $('#search')[0].value;
        $.get("/sectionData", {code: code}, function (res) {
            $("#result")[0].innerText = res;
            $("#result").removeClass("prettyprinted");
            PR.prettyPrint();
        })
    }
    function showdbinfo() {
        $(".content").hide();
        var x = $("#dbinfo")[0];
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
    function showdbaccess() {
        $(".content").hide();
        var x = $("#dbaccess")[0];
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
    function showapiaccess() {
        $(".content").hide();
        var x = $("#apiaccess")[0];
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
</script>
<h1>UBC Course Scraper and Database Accessor (Alpha)</h1>
<p style="word-wrap: break-word;">Welcome to the UBC course database. This website is the home of a third party tool that scrapes and stores all the information on the UBC course website so that it can be easily accessed through an API. Anyone is welcome to use it but please do not spam the server.</p>
<button onclick="showdbinfo()">database info</button>
<button onclick="showdbaccess()">database web access</button>
<button onclick="showapiaccess()">API information</button>
<div class="content" id="dbinfo" style="display: none">
<h3>Database information</h3>
<p id="lastScrapeId">Last Scrape: </p>
<p id="scrapeStatus">Scrape Status: </p>
<button onclick="update()">Update</button>
<button onclick="location.href='/Departments';">Table View</button>
</div>
<div class="content" id="dbaccess" style="display: none">
<h4>Database Accessor</h4>
<label for="search">Code: </label>
<input id="search"/>
<br>
<br>
<button onclick="getDepartments()">Get All Departments</button>
<button onclick="getDepartmentByCode()">Get Department By Code</button>
<button onclick="getCoursesByCode()">Get Courses By Code</button>
<button onclick="getSectionsByCode()">Get Sections By Code</button>
<button onclick="updateSectionInfo()">Update section info</button>
<br>
<pre class="prettyprint lang-json" id="result"></pre>
</div>
<div class="content" id="apiaccess" style="display: none">
<h4> API Access</h4>
<p>You use the information stored by this app in your own program through the API provided here.</p>
        <b>/getDepartments</b> List of all departments
        returns a list of all the departments as json objects that looks like this:
        <br>
<pre>
    {
        ID: int
        Name: String
        Code: String
        URL: String
        Faculty: String
    }
    </pre>
        <b>/getDepartmentByCode?code=""</b> List of courses by department code
        returns a department specified with a 'code' parameter in the post message:
<pre>
    {
        ID: int
        Name: String
        Code: String
        URL: String
        Faculty: String
    }
    </pre>
        <b>/getCoursesByCode?code=""</b> List of courses by department code
        returns a list of all the courses in a department specified with a 'code' parameter in the post message:
<pre>
    {
        ID: int
        Name: String
        Code: String
        URL: String
    }
    </pre>
        <b>/getSectionsByCode?code=""</b> List of sections by course code
        returns a list of all the sections ina course specified with a 'code' parameter in the post message:
<pre>
    {
        ID: int
        Code: String
        Teacher: String
        Building: String
        Room: String
        TotalSeatsRemaining: int
        CurrentlyRegistered: int
        GeneralSeatsRemaining: int
        RestrictedSeatsRemaining: int
    }
    </pre>
        <b>/getLastScrapeTime</b> Returns the last time the database was updated.
</div>
<br><br>
<a href="https://github.com/Ciuffi/UBCCourseScraper">Github</a>
</body>
</html>